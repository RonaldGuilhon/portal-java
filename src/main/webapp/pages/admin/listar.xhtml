<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets">

<h:head>
    <title>Gerenciar Notícias - Portal de Notícias</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <h:outputStylesheet library="css" name="style.css"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
</h:head>

<h:body>
    <f:view>
        <!-- Verificação de autenticação -->
        <f:event type="preRenderView" listener="#{loginController.verificarAutenticacao}"/>
        
        <!-- Navbar Admin -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <h:link class="navbar-brand" outcome="/pages/admin/listar.xhtml">
                    <i class="fas fa-newspaper"></i> Portal Admin
                </h:link>
                
                <div class="navbar-nav me-auto">
                    <h:link class="nav-link active" outcome="/pages/admin/listar.xhtml">
                        <i class="fas fa-list"></i> Notícias
                    </h:link>
                    <h:panelGroup rendered="#{loginController.usuarioLogado.perfil == 'ADMIN'}">
                        <h:link class="nav-link" outcome="/pages/admin/usuarios.xhtml">
                            <i class="fas fa-users"></i> Usuários
                        </h:link>
                    </h:panelGroup>
                </div>
                
                <div class="navbar-nav">
                    <span class="navbar-text me-3">
                        <i class="fas fa-user"></i> #{loginController.usuarioLogado.nome}
                    </span>
                    <h:form>
                        <h:commandLink action="#{loginController.logout}" styleClass="nav-link">
                            <i class="fas fa-sign-out-alt"></i> Sair
                        </h:commandLink>
                    </h:form>
                </div>
            </div>
        </nav>
        
        <!-- Conteúdo Principal -->
        <div class="container-fluid mt-4">
            <div class="row">
                <div class="col-12">
                    <!-- Cabeçalho -->
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h2><i class="fas fa-newspaper"></i> Gerenciar Notícias</h2>
                            <p class="text-muted">Gerencie todas as notícias do portal</p>
                        </div>
                        <h:link outcome="/pages/admin/form.xhtml" styleClass="btn btn-primary">
                            <i class="fas fa-plus"></i> Nova Notícia
                        </h:link>
                    </div>
                    
                    <!-- Mensagens -->
                    <h:messages globalOnly="true" styleClass="alert alert-info" 
                               showDetail="true" showSummary="false"/>
                    
                    <!-- Filtros -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <h:form>
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label class="form-label">Buscar por título:</label>
                                        <h:inputText value="#{noticiaController.filtroTitulo}" 
                                                   styleClass="form-control" 
                                                   placeholder="Digite o título..."/>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Status:</label>
                                        <h:selectOneMenu value="#{noticiaController.filtroStatus}" 
                                                       styleClass="form-select">
                                            <f:selectItem itemValue="" itemLabel="Todos"/>
                                            <f:selectItem itemValue="true" itemLabel="Ativas"/>
                                            <f:selectItem itemValue="false" itemLabel="Inativas"/>
                                        </h:selectOneMenu>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Autor:</label>
                                        <h:inputText value="#{noticiaController.filtroAutor}" 
                                                   styleClass="form-control" 
                                                   placeholder="Nome do autor..."/>
                                    </div>
                                    <div class="col-md-2 d-flex align-items-end">
                                        <h:commandButton value="Filtrar" 
                                                       action="#{noticiaController.filtrar}"
                                                       styleClass="btn btn-outline-primary me-2">
                                            <i class="fas fa-search"></i>
                                        </h:commandButton>
                                        <h:commandButton value="Limpar" 
                                                       action="#{noticiaController.limparFiltros}"
                                                       styleClass="btn btn-outline-secondary">
                                            <i class="fas fa-eraser"></i>
                                        </h:commandButton>
                                    </div>
                                </div>
                            </h:form>
                        </div>
                    </div>
                    
                    <!-- Tabela de Notícias -->
                    <div class="card">
                        <div class="card-body">
                            <h:form>
                                <div class="table-responsive">
                                    <h:dataTable value="#{noticiaController.noticias}" var="noticia" 
                                               styleClass="table table-striped table-hover"
                                               headerClass="table-dark">
                                        
                                        <h:column>
                                            <f:facet name="header">
                                                <i class="fas fa-image"></i> Imagem
                                            </f:facet>
                                            <h:panelGroup rendered="#{not empty noticia.imagemUrl}">
                                                <img src="#{noticia.imagemUrl}" alt="Imagem da notícia" 
                                                     style="width: 60px; height: 40px; object-fit: cover; border-radius: 4px;"/>
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{empty noticia.imagemUrl}">
                                                <div class="bg-light d-flex align-items-center justify-content-center" 
                                                     style="width: 60px; height: 40px; border-radius: 4px;">
                                                    <i class="fas fa-image text-muted"></i>
                                                </div>
                                            </h:panelGroup>
                                        </h:column>
                                        
                                        <h:column>
                                            <f:facet name="header">
                                                <i class="fas fa-heading"></i> Título
                                            </f:facet>
                                            <strong>#{noticia.titulo}</strong>
                                            <br/>
                                            <small class="text-muted">#{noticia.resumo}</small>
                                        </h:column>
                                        
                                        <h:column>
                                            <f:facet name="header">
                                                <i class="fas fa-user"></i> Autor
                                            </f:facet>
                                            #{noticia.autor.nome}
                                        </h:column>
                                        
                                        <h:column>
                                            <f:facet name="header">
                                                <i class="fas fa-calendar"></i> Data
                                            </f:facet>
                                            <h:outputText value="#{noticia.dataPublicacao}">
                                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                                            </h:outputText>
                                        </h:column>
                                        
                                        <h:column>
                                            <f:facet name="header">
                                                <i class="fas fa-toggle-on"></i> Status
                                            </f:facet>
                                            <h:panelGroup rendered="#{noticia.ativa}">
                                                <span class="badge bg-success">
                                                    <i class="fas fa-check"></i> Ativa
                                                </span>
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{not noticia.ativa}">
                                                <span class="badge bg-secondary">
                                                    <i class="fas fa-times"></i> Inativa
                                                </span>
                                            </h:panelGroup>
                                        </h:column>
                                        
                                        <h:column>
                                            <f:facet name="header">
                                                <i class="fas fa-cogs"></i> Ações
                                            </f:facet>
                                            <div class="btn-group" role="group">
                                                <h:commandLink action="#{noticiaController.editar(noticia.id)}" 
                                                             styleClass="btn btn-sm btn-outline-primary"
                                                             title="Editar">
                                                    <i class="fas fa-edit"></i>
                                                </h:commandLink>
                                                
                                                <h:commandLink action="#{noticiaController.alterarStatus(noticia.id)}" 
                                                             styleClass="btn btn-sm #{noticia.ativa ? 'btn-outline-warning' : 'btn-outline-success'}"
                                                             title="#{noticia.ativa ? 'Desativar' : 'Ativar'}"
                                                             onclick="return confirm('Tem certeza que deseja #{noticia.ativa ? 'desativar' : 'ativar'} esta notícia?')">
                                                    <i class="fas #{noticia.ativa ? 'fa-eye-slash' : 'fa-eye'}"></i>
                                                </h:commandLink>
                                                
                                                <h:commandLink action="#{noticiaController.excluir(noticia.id)}" 
                                                             styleClass="btn btn-sm btn-outline-danger"
                                                             title="Excluir"
                                                             onclick="return confirm('Tem certeza que deseja excluir esta notícia? Esta ação não pode ser desfeita.')">
                                                    <i class="fas fa-trash"></i>
                                                </h:commandLink>
                                            </div>
                                        </h:column>
                                    </h:dataTable>
                                </div>
                                
                                <!-- Mensagem quando não há notícias -->
                                <h:panelGroup rendered="#{empty noticiaController.noticias}">
                                    <div class="text-center py-5">
                                        <i class="fas fa-newspaper fa-3x text-muted mb-3"></i>
                                        <h4 class="text-muted">Nenhuma notícia encontrada</h4>
                                        <p class="text-muted">Comece criando sua primeira notícia!</p>
                                        <h:link outcome="/pages/admin/form.xhtml" styleClass="btn btn-primary">
                                            <i class="fas fa-plus"></i> Criar Primeira Notícia
                                        </h:link>
                                    </div>
                                </h:panelGroup>
                            </h:form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    </f:view>
</h:body>
</html>